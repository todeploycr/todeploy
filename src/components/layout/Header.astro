---
// Header.astro
import logoPrimatica from "@/assets/img/logo.png";

const navItems = [
  { name: "Inicio", href: "/#inicio" },
  { name: "Servicios", href: "/#servicios" },
  { name: "Portfolio", href: "/#portfolio" },
  { name: "Nosotros", href: "/#nosotros" },
  { name: "IA", href: "/#ia" },
  { name: "Contacto", href: "/#contacto" },
];
---

<header
  id="header"
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 py-3 sm:py-4 md:py-5 header-animate"
>
  <div
    class="max-w-7xl mx-auto px-2 sm:px-3 lg:px-4 flex items-center justify-between"
  >
    <!-- Logo - Responsive -->
    <a href="/#inicio" class="flex items-center gap-2 sm:gap-3 relative z-10">
          <div class="relative w-12 h-12 shrink-0">
            <img 
              src={logoPrimatica.src} 
              alt="toDeploy Logo" 
              class="w-full h-full object-contain group-hover:scale-110 transition-transform duration-300"
            />
          </div>
          <div>
            <span class="font-heading font-semibold text-base sm:text-lg text-white"
              >toDeploy</span
            >
            <span class="block text-xs text-gray-400"
              >Software & Automation</span
            >
          </div>
    </a>

    <!-- Desktop Navigation -->
    <nav class="hidden lg:flex items-center gap-6 xl:gap-8">
      {
        navItems.map((item) => (
          <a
            href={item.href}
            class="text-sm font-medium text-gray-300 hover:text-[#00D6A1] transition-colors relative group"
          >
            {item.name}
            <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-[#00D6A1] transition-all duration-300 group-hover:w-full" />
          </a>
        ))
      }
    </nav>

    <!-- CTA Button - Desktop -->
    <div class="hidden lg:block">
      <a
        href="/#contacto"
        class="bg-[#00D6A1] hover:bg-[#00D6A1]/90 text-[#0a0b1a] font-bold px-6 py-2 rounded-lg transition-all duration-300 inline-block shadow-lg hover:shadow-[#00D6A1]/50"
      >
        Contáctanos
      </a>
    </div>

    <!-- Mobile Menu Button -->
    <button
      id="mobile-menu-button"
      class="lg:hidden p-2 text-white relative z-10 hover:bg-white/10 rounded-lg transition-colors"
      aria-label="Toggle menu"
    >
      <svg
        id="menu-icon"
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
      <svg
        id="close-icon"
        class="w-6 h-6 hidden"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>

  <!-- Mobile Menu - Responsive -->
  <div
    id="mobile-menu"
    class="lg:hidden bg-white/5 backdrop-blur-xl border border-white/10 mt-3 mx-3 sm:mx-4 rounded-lg p-4 sm:p-6 hidden opacity-0 transition-opacity duration-300"
  >
    <nav class="flex flex-col gap-3 sm:gap-4">
      {
        navItems.map((item) => (
          <a
            href={item.href}
            class="mobile-menu-link text-sm sm:text-base font-medium text-gray-300 hover:text-[#00D6A1] transition-colors py-2 px-3 rounded-lg hover:bg-white/5"
          >
            {item.name}
          </a>
        ))
      }
      <a
        href="/#contacto"
        class="mobile-menu-link bg-[#00D6A1] hover:bg-[#00D6A1]/90 text-[#0a0b1a] font-bold w-full mt-2 py-3 rounded-lg transition-colors text-center text-sm sm:text-base"
      >
        Contáctanos
      </a>
    </nav>
  </div>
</header>

<script>
  // Header initial animation
  const header = document.getElementById("header");
  if (header) {
    // Trigger animation on load
    setTimeout(() => {
      header.classList.add("show");
    }, 100);
  }

  // Header scroll effect
  let lastScrollY = window.scrollY;

  function handleScroll() {
    const scrollY = window.scrollY;

    if (scrollY > 50) {
      header?.classList.add("scrolled");
    } else {
      header?.classList.remove("scrolled");
    }

    lastScrollY = scrollY;
  }

  window.addEventListener("scroll", handleScroll);

  // Mobile menu toggle
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");
  const menuIcon = document.getElementById("menu-icon");
  const closeIcon = document.getElementById("close-icon");
  const mobileMenuLinks = document.querySelectorAll(".mobile-menu-link");

  function toggleMobileMenu() {
    const isOpen = !mobileMenu?.classList.contains("hidden");

    if (isOpen) {
      mobileMenu?.classList.add("opacity-0");
      setTimeout(() => {
        mobileMenu?.classList.add("hidden");
      }, 300);
      menuIcon?.classList.remove("hidden");
      closeIcon?.classList.add("hidden");
    } else {
      mobileMenu?.classList.remove("hidden");
      setTimeout(() => {
        mobileMenu?.classList.remove("opacity-0");
      }, 10);
      menuIcon?.classList.add("hidden");
      closeIcon?.classList.remove("hidden");
    }
  }

  mobileMenuButton?.addEventListener("click", toggleMobileMenu);

  // Close mobile menu when clicking on a link
  mobileMenuLinks.forEach((link) => {
    link.addEventListener("click", () => {
      if (!mobileMenu?.classList.contains("hidden")) {
        toggleMobileMenu();
      }
    });
  });

  // Close mobile menu when clicking outside
  document.addEventListener("click", (e) => {
    const target = e.target as HTMLElement;
    const isMenuButton = target.closest("#mobile-menu-button");
    const isMenu = target.closest("#mobile-menu");

    if (!isMenuButton && !isMenu && !mobileMenu?.classList.contains("hidden")) {
      toggleMobileMenu();
    }
  });
</script>

<style>
  /* Header initial state - solid background */
  #header {
    background: #0a0b1a;
    border-bottom: 1px solid transparent;
  }

  /* Header initial animation */
  .header-animate {
    transform: translateY(-100px);
    transition:
      transform 0.6s ease-out,
      background 0.3s ease,
      border-color 0.3s ease,
      backdrop-filter 0.3s ease,
      padding 0.3s ease;
  }

  .header-animate.show {
    transform: translateY(0);
  }

  /* Scrolled state - add transparency and blur */
  #header.scrolled {
    background: rgba(10, 11, 26, 0.8);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  /* Mobile scrolled adjustments */
  @media (max-width: 640px) {
    #header.scrolled {
      padding-top: 0.5rem;
      padding-bottom: 0.5rem;
    }
  }

  /* Tablet scrolled adjustments */
  @media (min-width: 641px) and (max-width: 1023px) {
    #header.scrolled {
      padding-top: 0.625rem;
      padding-bottom: 0.625rem;
    }
  }

  /* Prevent body scroll when mobile menu is open */
  body.menu-open {
    overflow: hidden;
  }

  /* Mobile menu animation */
  #mobile-menu {
    max-height: calc(100vh - 80px);
    overflow-y: auto;
  }

  /* Custom scrollbar for mobile menu */
  #mobile-menu::-webkit-scrollbar {
    width: 4px;
  }

  #mobile-menu::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 2px;
  }

  #mobile-menu::-webkit-scrollbar-thumb {
    background: rgba(0, 214, 161, 0.5);
    border-radius: 2px;
  }

  #mobile-menu::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 214, 161, 0.7);
  }
</style>